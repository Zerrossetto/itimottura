<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<title>ORDINE DI PAGAMENTO COMODATO D&#39;USO LIBRI PRIMO ANNO</title>
		<script type="text/javascript">
		function canTransmit(f)
		{
			var fields = [f.alunno, f.classe, f.sezione, f.emailCompratore];
			for (var i = 0; i < fields.length; i++)
			{
				if(fields[i].value == "")
				{
					f.sub.disabled = true;
					return false;
				}
			}
			f.sub.disabled = false;
			return true;
		}
		
		var prezzi = {<?= implode(", ", Helper::implodeDictionary(":", $arr, true)); ?>};

		function updateprice(f)
		{
			if (f.classe.value != "" && f.sezione.value != "")
			{
				var key = f.classe.value.toString() + f.sezione.value;
				if (prezzi.hasOwnProperty(key))
					{ var prezzo = prezzi[key]; } 
				else 
					{ var prezzo = prezzi[f.classe.value.toString()]; }
				f.totale.value = parseFloat(prezzo).toFixed(2);
				document.getElementById("quota").innerHTML = "Quota comodato: <span>&euro; "+ parseFloat(prezzo).toFixed(2) +"</span>";
			} else {
				f.totale.value = 0;
				document.getElementById("quota").innerHTML = "Quota comodato: <span>N/A</span>";
			}
			canTransmit(f);
		}

		</script>
	</head>
	<body onload="updateprice(document.forms[0])">
		<h1>ORDINE DI PAGAMENTO COMODATO D&#39;USO LIBRI</h1>
		<?php if(@$_POST["do"] == "validate" && array_key_exists("database", $errors)): ?>
		<p class="error">Si &egrave; verificato un errore interno prego segnalare all&#39;amministratore di sistema</p>
		<p class="error"><?= $errors["database"]; ?></p>
		<?php else: ?>
		<form method="post" action="pay.php">
			<div>
				<label for="alunno" >Nome dell&#39;alunno</label>
				<input type="text" name="alunno" maxlength="75" value="<?= @$_POST["alunno"] ?>" onkeydown="canTransmit(this.form)" />
				<?php if(@$_POST["do"] == "validate" && array_key_exists("alunno", $errors)): ?>
				<span class="error"><?= $errors["alunno"] ?></span>
				<?php endif; ?>
			</div>
			<div>
				<label for="classe" >Seleziona una classe</label>
				<select name="classe" onchange="updateprice(this.form)">
					<option value="">---</option>
					<?php foreach (range(1, 5) as $i): ?>
					<option value="<?= $i ?>" <?php if(@$_POST["classe"] == $i): ?>selected="selected"<?php endif; ?>><?= $i ?></option>
					<?php endforeach; ?> 
				</select>
				&nbsp;
				<label for="sezione">Sezione</label>
				<select name="sezione" onchange="updateprice(this.form)">
					<option value="">---</option>
					<?php foreach (range("A", "G") as $i): ?>
					<option value="<?= $i ?>" <?php if(@$_POST["sezione"] == $i): ?>selected="selected"<?php endif; ?>><?= $i ?></option>
					<?php endforeach; ?> 
				</select>
				<?php if(@$_POST["do"] == "validate" && array_key_exists("totale", $errors)): ?>
				<span class="error"><?= $errors["totale"] ?></span>
				<?php endif; ?>
			</div>
			<div>
				<label id="quota" for="totale">Quota comodato: <span>N/A</span></label>
				<input type="hidden" name="totale" />
			</div>
			<div>
				<label for="emailCompratore">Indirizzo e-mail</label>
				<input type="text" name="emailCompratore" value="<?= @$_POST["emailCompratore"] ?>" maxlength="50" onkeydown="canTransmit(this.form)" />		
				<?php if(@$_POST["do"] == "validate" && array_key_exists("email", $errors)): ?>
				<span class="error"><?= $errors["email"] ?></span>
				<?php endif; ?>
			</div>
			<div>
				<input type="hidden" name="tipoPagamento" value="CartCred" />
				<input type="hidden" name="langCompratore" value="it" />
				<input type="hidden" name="do" value="validate" />
				<input type="submit" name="sub" value="Paga con carta di credito" disabled="disabled" />
			</div>
			</form>
			<?php endif; /*ends if(array_key_exists("database", $errors))*/ ?>
	</body>
</html>